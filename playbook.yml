---
- hosts: all
  connection: local
  
  roles:
    - role: ableton.nix

  vars_files:
    - vars.yml

  pre_tasks:
    - name: "Update apt cache if needed."
      apt:
        update_cache: yes
        cache_valid_time: 3600
      become: true

    - name: "Install aptitude - preferred for ansible"
      apt:
        state: latest
        name:
          - aptitude
      become: true

    - name: "Update all packages to the latest version"
      apt:
        upgrade: dist
      become: true

  tasks:
    # - include_tasks: tasks/locale.yml

    # - name: "Install apt cmd line apps"
    #   apt:
    #     state: latest
    #     name:
    #       - unzip
    #   become: true

    # - include_tasks: tasks/aws-vault.yml
    #   when: install_aws_vault

  post_tasks:
    - name: "apt autoclean && autoremove"
      apt:
        autoclean: yes
        autoremove: yes
      become: true
